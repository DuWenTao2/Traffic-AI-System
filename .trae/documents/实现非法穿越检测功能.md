# 实现非法穿越检测功能

## 1. 需求分析
需要实现以下功能：
- 在 YOLOv8 检测中添加人和非机动车类别
- 创建新的违规检测模块，检测非法穿越
- 模仿 Parking 检测器的处理方式，实现截图保存和违规记录

## 2. 实现步骤

### 2.1 修改检测类别
- **文件**：`Processing Models/VideoProcessorMP.py`
- **修改内容**：
  - 在 `VEHICLE_CLASSES` 中添加 person (0) 和 bicycle (4) 类别
  - 确保 YOLOv8 检测时包含这些类别

### 2.2 创建新的非法穿越检测器
- **文件**：`Models/IllegalCrossing/illegal_crossing_detector.py`
- **实现内容**：
  - 创建 `IllegalCrossingDetector` 类，继承类似结构于 `ParkingDetector`
  - 实现初始化、检测、违规处理、截图保存等方法
  - 支持检测区域配置
  - 支持违规时间限制
  - 集成 ViolationManager 进行违规记录

### 2.3 集成到 VideoProcessorMP
- **文件**：`Processing Models/VideoProcessorMP.py`
- **修改内容**：
  - 导入新的 `IllegalCrossingDetector`
  - 在初始化方法中添加非法穿越检测配置
  - 在主循环中调用非法穿越检测
  - 添加非法穿越检测的开关控制

### 2.4 更新 AreaType 枚举
- **文件**：`Processing Models/areas.py`
- **修改内容**：
  - 添加 `ILLEGAL_CROSSING` 枚举值
  - 添加对应的颜色配置

### 2.5 更新违规管理器
- **文件**：`Violation_Proc/violation_manager.py`
- **修改内容**：
  - 添加 `record_illegal_crossing_violation` 方法
  - 支持非法穿越违规的记录和截图保存

### 2.6 更新配置
- **文件**：`config.conf`
- **修改内容**：
  - 添加非法穿越检测的配置项

## 3. 实现细节

### 3.1 检测逻辑
- 检测区域内出现 person (0) 或 bicycle (4) 等非机动车类别
- 超过设定时间（如5秒）视为非法穿越
- 记录违规行为并保存截图

### 3.2 模仿 Parking 检测器的处理方式
- 使用类似的违规跟踪机制
- 相同的截图保存逻辑
- 集成统一的 ViolationManager
- 相似的日志记录方式

### 3.3 文件结构
```
Models/
├── IllegalCrossing/
│   └── illegal_crossing_detector.py
├── Parking Model/
│   └── parking_Detctor.py
└── ...
```

## 4. 预期效果
- 能够检测到人和非机动车
- 在指定区域内检测到这些类别时，记录违规行为
- 保存违规截图
- 集成到现有的违规管理系统中

## 5. 测试计划
- 运行主程序，验证检测功能
- 测试违规记录和截图保存
- 验证集成到现有系统中的稳定性

## 6. 注意事项
- 确保与现有代码的兼容性
- 保持代码风格的一致性
- 确保线程安全性
- 实现适当的错误处理

这个计划将确保我们按照需求实现非法穿越检测功能，同时保持与现有系统的良好集成。