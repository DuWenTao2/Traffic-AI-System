# 道路抛洒物检测功能开发与集成方案

## 1. 功能模块设计

### 1.1 创建道路抛洒物检测模块
- **文件路径**：`Models/RoadDebris/RoadDebrisDetector.py`
- **核心功能**：
  - 加载 YOLO 模型进行道路抛洒物检测
  - 实现参数优先级机制：动态传入 > 配置文件 > 默认值
  - 检测到抛洒物时触发违规记录流程
  - 提供开启/关闭功能

### 1.2 配置文件设计
- **文件路径**：`Models/Config/RoadDebrisDetectionConfig.json`
- **配置参数**：
  - 检测灵敏度（conf_threshold）
  - 最小检测面积（min_area）
  - 检测频率（frame_skip）
  - 冷却时间（cooldown）
  - 模型路径（model_path）

## 2. 系统集成

### 2.1 集成到 VideoProcessorMP.py
- **添加模块导入**：在适当位置添加 RoadDebrisDetector 导入
- **初始化检测器**：在检测模块初始化部分添加 RoadDebrisDetector 实例
- **添加按键控制**：添加专用按键（建议使用 'x' 键）用于启动/停止检测
- **添加处理逻辑**：在主处理循环中添加道路抛洒物检测调用

### 2.2 违规记录集成
- **使用现有 ViolationManager**：利用现有的违规管理系统处理截图存储
- **添加抛洒物违规类型**：在 ViolationManager 中添加道路抛洒物违规类型
- **截图存储**：将检测结果截图存储到 `Violation_Proc/violations/snapshots/road_debris` 目录

## 3. 技术实现细节

### 3.1 检测器核心实现
- **参考事故检测模块**：基于 AccidentDetector 实现，保持代码风格一致
- **模型加载**：集成 `weights/Road_Detris_Detection/best.pt` 模型
- **检测逻辑**：实时处理视频帧，使用 YOLO 模型检测抛洒物
- **异常处理**：实现模型加载失败、文件存储异常等情况的处理

### 3.2 参数优先级机制
- **动态传入参数**：最高优先级，通过构造函数传入
- **配置文件参数**：其次优先级，从配置文件加载
- **系统默认值**：最低优先级，确保系统稳定运行

### 3.3 性能优化
- **帧跳过机制**：通过 frame_skip 参数控制检测频率，减少计算负担
- **冷却时间**：避免短时间内重复检测同一抛洒物
- **多线程安全**：确保在多进程环境下稳定运行

## 4. 兼容性与测试

### 4.1 兼容性保证
- **不影响现有功能**：确保新增功能不干扰其他检测模块
- **硬件兼容性**：适应不同硬件配置，提供合理的性能参数
- **操作系统兼容性**：确保在不同操作系统下正常运行

### 4.2 测试计划
- **功能测试**：验证抛洒物检测功能是否正常工作
- **性能测试**：评估检测对系统整体性能的影响
- **兼容性测试**：确保与现有功能模块协同工作

## 5. 交付内容

- **核心代码**：`Models/RoadDebris/RoadDebrisDetector.py`
- **配置文件**：`Models/Config/RoadDebrisDetectionConfig.json`
- **集成修改**：`Processing Models/VideoProcessorMP.py` 的相关修改
- **功能说明文档**：道路抛洒物检测功能使用指南

## 6. 技术要点

- **模块化设计**：保持代码结构清晰，易于维护
- **参数可配置**：提供灵活的参数配置机制
- **错误处理**：确保系统在各种异常情况下稳定运行
- **性能优化**：平衡检测精度与系统性能
- **与现有系统集成**：遵循项目现有架构和代码风格